## Kubernete Scheduler 技术原理

`kube-scheduler`是`Kubernetes`的默认调度程序。它负责将Pod放置在群集中的节点上。

群集中满足Pod调度要求的节点称为Pod可行节点。调度程序找到Pod的可行节点，然后运行一组函数对可行节点进行评分，从可行评分中选择得分最高的节点来运行Pod。然后，调度程序在Binding的过程中将该决定通知API服务器。

### Percentage of Nodes ot Score
在Kubernetes 1.12之前，`Kube-scheduler`用于检查集群中所有节点的可行性，然后对可行节点进行评分。 Kubernetes 1.12添加了一项新功能，一旦发现一定数量的节点，调度程序就可以停止寻找更可行的节点。这样可以提高大型集群中调度程序的性能。该数字指定为集群大小的百分比。百分比可以由名为percentOfNodesToScore的配置选项控制。范围应在1到100之间。较大的值视为100％。零等于不提供config选项。如果未在配置中指定，Kubernetes 1.14可以根据集群的大小找到要评分的节点的百分比。它使用一个线性公式，对于一个100节点的集群，该公式的结果为50％。对于5000节点的群集，该公式的结果为10％。自动制定的下限值为5％。换句话说，除非用户为config选项提供的值小于5，否则调度程序始终会为群集的至少5％的节点评分。


·percentOfNodesToScore·必须为1到100之间的值，默认值是根据群集大小计算的。还有一个50个节点的硬编码最小值。这意味着在具有数百个节点的群集中将此选项更改为较低的值不会对调度程序尝试查找的可行节点的数量产生太大影响。这是有意设定的，因为此选项不太可能在较小的群集中显着提高性能。在具有超过1000个节点的大型群集中，将此值设置为较小的数字可能会显示出明显的性能改进。

设置此值时要考虑的重要注意事项是，当检查群集中较少数量的节点的可行性时，对于给定的Pod，不会发送某些节点进行评分。结果，可能为运行给定Pod评分更高的Node甚至不会传递到评分阶段。这将导致Pod放置不理想。因此，不应将值设置为非常低的百分比。一般的经验法则是，永远不要将值设置为小于10的任何值。仅当调度程序的吞吐量对您的应用程序至关重要且节点的分数不重要时，才应使用较小的值。换句话说，您倾向于在任何节点上运行Pod（只要可行）。

如果您的群集中有数百个或更少的节点，我们不建议您降低此配置选项的默认值。不可能显着改善调度程序的性能。


为了使群集中的所有节点都有运行Pods的机会，调度程序以循环方式遍历节点。您可以想象节点在数组中。调度程序从数组的开头开始，检查节点的可行性，直到找到由percentOfNodesToScore指定的足够的节点为止。对于下一个Pod，调度程序从检查先前Pod的Nodes可行性时停止在Node数组中的位置继续。

如果节点在多个区域中，则调度程序会在各个区域中的节点上进行迭代，以确保在可行性检查中考虑来自不同区域的节点。例如，考虑两个区域中的六个节点:    
`Zone 1: Node 1, Node 2, Node 3, Node 4    
Zone 2: Node 5, Node 6`

调度程序按以下顺序评估节点的可行性:    
`Node 1, Node 5, Node 2, Node 6, Node 3, Node 4`    
遍历所有节点后，它返回到节点1。
